<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>My first Bulma website</title>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="js/modal.js"></script>
    <link rel="stylesheet" href="css/main.css">
  </head>
  <body>
    <!-- React App -->
    <div id="app"></div>

    <!-- Modal -->
    <!--
    <div id="modal-js-example" class="modal is-active">
      <div class="modal-background"></div>

      <div class="modal-content center-flex">
        <div class="box rounded">

          <div class="box-header">
            <div class="rating-star-container rating-star-circle center-flex">
              <img class="rating-star" src="images/icon-star.svg" alt="star">
            </div>
          </div>

          <h1 class="box-h2 box-title">How did we do?</h1>

          <p class="box-paragraph">
            Please let us know how we did with your support request. All feedback is appreciated
            to help us improve our offering!
          </p>

          <div class="circle-row">
            <div class="circle circle-margin center-flex">1</div>
            <div class="circle circle-margin center-flex">2</div>
            <div class="circle circle-margin center-flex">3</div>
            <div class="circle circle-margin center-flex">4</div>
            <div class="circle circle-margin center-flex">5</div>
          </div>

          <button class="rounded-button text-is-white is-orange center-flex">
            <div class="submit-text">Submit</div>
          </button>

        </div>
      </div>

      <button class="modal-close is-large" aria-label="close"></button>
    </div>
    -->
    <!-- Modal Trigger -->
    <button class="js-modal-trigger" data-target="modal-js-example">
      Open JS example modal
    </button>

    <!-- Scripts -->
    <script type="text/jsx">
      const app = document.getElementById('app');

      class Modal extends React.Component {

        constructor(props) {
          super(props);
          this.state = {active: props.active, selected: null}; // the selected rating
          this.handleChangeRating = this.handleChangeRating.bind(this);
          this.closeModal = this.closeModal.bind(this);
        }

        componentDidMount() {
          this.timerID = setInterval(
            () => this.tick(),
            1000
          );
        }

        componentWillUnmount() {
          clearInterval(this.timerID);
        }

        tick() {
          this.setState({
            active: this.props.active
          });
        }

        handleChangeRating(number) {
          console.log("The selected number is : " + number);
          this.setState({selected: number})
        }

        closeModal() {
          this.props.onCloseRatingsModal();
        }

        render() {
          const isActive = this.state.active;

          return (
            <div>
            {isActive ?
              <div id="modal-js-example" className="modal is-active">
                <div className="modal-background"></div>
                <div className="modal-content center-flex">
                  <Card
                    title="How did we do?"
                    paragraph="Please let us know how we did with your support request. All feedback is appreciated
                    to help us improve our offering!"
                    onRatingChange={this.handleChangeRating}
                  />
                </div>
                <button onClick={this.closeModal} className="modal-close is-large" aria-label="close"></button>
              </div>
            : null}
            </div>
          );
        }
      }

      class Card extends React.Component {
        constructor(props) {
          super(props);
          this.state = {title: props.title, paragraph: props.paragraph};
        }

        render() {
          const title = this.props.title;
          const paragraph = this.props.paragraph;

          return (<div className="box rounded">
            <CardHeader />
            <CardTitle text={title} />
            <CardParagraph text={paragraph} />
            <HorizontalRatings onRatingChange={this.props.onRatingChange} />
            <RoundSubmitButton />
          </div>);
        }
      }

      function CardHeader() {
        return (<div className="box-header">
          <div className="rating-star-container rating-star-circle center-flex">
            <img className="rating-star" src="images/icon-star.svg" alt="star" />
          </div>
        </div>);
      }

      function CardTitle({text}) {
        return (<h1 className="box-h2 box-title">{text}</h1>);
      }

      function CardParagraph({text}) {
        return (
          <p className="box-paragraph">{text}</p>
        );
      }

      class HorizontalRatings extends React.Component {
        constructor(props) {
          super(props);
        }

        render() {
          return (
          <div className="circle-row">

            <Rating onRatingChange = {this.props.onRatingChange} number="1" />
            <Rating onRatingChange = {this.props.onRatingChange} number="2" />
            <Rating onRatingChange = {this.props.onRatingChange} number="3" />
            <Rating onRatingChange = {this.props.onRatingChange} number="4" />
            <Rating onRatingChange = {this.props.onRatingChange} number="5" />

          </div>);
        }
      }

      class Rating extends React.Component {
        /**
          The ratings that the user can choose to click.
        */
        constructor(props) {
          super(props);
          this.state = {number: props.number, selected: false}
          this.handleClick = this.handleClick.bind(this);
        }

        handleClick(e) {
          this.props.onRatingChange(this.props.number);
        }

        render() {
          return (<div className="circle center-flex" onClick={this.handleClick}>{this.props.number}</div>);
        }
      }

      function RoundSubmitButton() {
        return (<button className="rounded-button text-is-white is-orange center-flex">
          <div className="submit-text">Submit</div>
        </button>);
      }

      function Header({title}) {
        return (<h1>{title ? title : 'Default title'}</h1>)
      }

      class HomePage extends React.Component {

        constructor(props) {
          super(props);
          this.state = {ratingsModalActive: false};
          this.openRatingsModal = this.openRatingsModal.bind(this);
          this.closeRatingsModal = this.closeRatingsModal.bind(this);
        }

        openRatingsModal() {
          this.setState({ratingsModalActive: true});
        }

        closeRatingsModal() {
          this.setState({ratingsModalActive: false});
        }

        render() {
          const ratingsModalActive = this.state.ratingsModalActive;

          return (
            <div>
              {/* Header comp */}
              <button onClick={this.openRatingsModal}>Launch Modal</button>
              <Modal active={ratingsModalActive} onCloseRatingsModal={this.closeRatingsModal} />
            </div>
          );
        }
      }

      ReactDOM.render(
      <React.StrictMode>
        <HomePage />
      </React.StrictMode>
      , app);
    </script>
    <script type="text/javascript" src="lib/main.js"></script>
  </body>
</html>
