<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@100&display=swap" rel="stylesheet">
    <title>Black Material</title>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/style.css">
    <!-- CSS -->
    <link rel="stylesheet" href="css/flickity.min.css">

  </head>
  <body>

    <!-- Main Carousel -->
    <div class="main-carousel" data-flickity='{ "cellAlign": "left", "contain": true }'>
      <div id="a1-1" class="carousel-cell">        
        <img src="assets/lobster1.jpg" />
      </div>
      <div id="a1-2" class="carousel-cell">        
        <img src="assets/lobster1.jpg" />
      </div>
      <div id="a2-1" class="carousel-cell">
        <img src="assets/avocado1.jpg" />
      </div>
      <div id="a2-2" class="carousel-cell">
        <img src="assets/avocado1.jpg" />
      </div>      
      <div id="a3-1" class="carousel-cell">
        <img src="assets/seafood2.jpg" />
      </div>
      <div id="a3-2" class="carousel-cell">
        <img src="assets/seafood2.jpg" />
      </div>      
      <div id="a4-1" class="carousel-cell">
        <img src="assets/seafood3.jpg" />
      </div>
      <div id="a4-2" class="carousel-cell">
        <img src="assets/seafood3.jpg" />
      </div>      
      <div id="a5-1" class="carousel-cell">
        <img src="assets/lobster1.jpg" />
      </div>
      <div id="a5-2" class="carousel-cell">
        <img src="assets/lobster1.jpg" />
      </div>      
      <div id="a6-1" class="carousel-cell">
        <img src="assets/seafood2.jpg" />
      </div>
      <div id="a6-2" class="carousel-cell">
        <img src="assets/seafood2.jpg" />
      </div>      
    </div>

    <div class="carousel-cell-info" style="font-size: 4em; color: white;">
      <h1 id="carousel-picker-logger"></h1>
    </div>

    <!-- Nav menu -->
    <div id="navbar-mask-toggle" class="navbar-mask">
      <nav class="navbar"></nav>
    </div>

    <!-- Menu Visualization Interface -->
    <div id="menu-viz" class="menu-visualization-interface-bg">
      <!-- Rotated boxes container -->
      <div id="menu-viz-rotated-boxes-container" class="my-is-flex is-vertical is-centered is-rotated-and-translated-y">
        <!-- Row container -->
        <div class="menu-viz-row-container is-vertical">          
          <h1>LOBSTER</h1>
          <img src="" alt="img-here" />
        </div>    
        <div class="menu-viz-row-container is-vertical">          
          <h1>LOBSTER 2: VIDEO</h1>
          <img src="" alt="img-here" />
        </div>             
        <div class="menu-viz-row-container is-vertical">
          <div>CRAB</div>
          <img src="" alt="img-here" />          
        </div>
        <div class="menu-viz-row-container is-vertical">
          <div>BASS</div>
          <img src="" alt="img-here" />          
        </div>
        <div class="menu-viz-row-container is-vertical">
          <div>SALMON</div>
          <img src="" alt="img-here" />          
        </div>
        <div class="menu-viz-row-container is-vertical">
          <div>POLAR BEAR</div>
          <img src="" alt="img-here" />          
        </div>      
        <div class="menu-viz-row-container is-vertical">
          <div>TURTLE</div>
          <iframe width="560" height="315" src="https://www.youtube.com/embed/48oG1o6ykzk?controls=0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
          <img src="" alt="img-here" />          
        </div>                                                          
      </div>
      <!-- Horizontal Labels container -->
      <div id="menu-viz-horizontal-labels-container" class="my-is-flex is-left-centered">
        <!-- Row container -->
        <div class="menu-viz-horizontal-row-container">          
          <div class="my-is-flex is-vertical">
            <h1>LOBSTER 1</h1>
            <p>Fresh lobsters 1</p>  
          </div>
        </div>        
        <div class="menu-viz-horizontal-row-container">          
          <div class="my-is-flex is-vertical">
            <h1>LOBSTER 2</h1>
            <p>Fresh lobsters 2</p>
          </div>
        </div>        
        <div class="menu-viz-horizontal-row-container">          
          <div class="my-is-flex is-vertical">
            <h1>LOBSTER 3</h1>
            <p>Fresh lobsters 3</p> 
          </div>
        </div>        
        <div class="menu-viz-horizontal-row-container">          
          <div class="my-is-flex is-vertical">
            <h1>LOBSTER 4</h1>
            <p>Fresh lobsters 4</p> 
          </div>
        </div>        
        <div class="menu-viz-horizontal-row-container">          
          <div class="my-is-flex is-vertical">
            <h1>LOBSTER 5</h1>
            <p>Fresh lobsters 5</p>  
          </div>
        </div>        
        <div class="menu-viz-horizontal-row-container">          
          <div class="my-is-flex is-vertical">
            <h1>LOBSTER 6</h1>
            <p>Fresh lobsters 6</p>
          </div>
        </div>        

      </div>
      <!-- Keyboard Nav menu -->      
      <div id="navbar-keyboard-container">
        <nav class="navbar-keyboard-flex is-bottom-center-fixed">
          <h1 class="branding-text">Material Love</h1>
          <div id="keyboard-rect-0" class="rectangle keyboard-rectangle"></div>                    
          <div id="keyboard-rect-1" class="rectangle keyboard-rectangle"></div>
          <div id="keyboard-rect-2" class="rectangle keyboard-rectangle"></div>
          <div id="keyboard-rect-3" class="rectangle keyboard-rectangle"></div>                    
          <div id="keyboard-rect-4" class="rectangle keyboard-rectangle"></div>
          <div id="keyboard-rect-5" class="rectangle keyboard-rectangle"></div>
        </nav>
      </div>     
      <!-- Keyboard Selection Indicator -->
      <div class="rectangle selection-indicator is-bottom-center is-outside-viewport bg-is-white"></div>
    </div>

    <!-- Scripts -->
    <script type="text/javascript" src="lib/main.js"></script>
    <!-- Flickity -->
    <script src="js/flickity/flickity.pkgd.min"></script>
    <!-- Jquery -->
    <script src="js/jquery/jquery-3.6.0.min"></script>

    <script>

      // Event handler
      function handleEventListeners(evt) {
        const logger = document.getElementById("carousel-picker-logger");
        logger.innerHTML = evt.target.getAttribute("id");
      }

      function handleNavbarMaskAnim(evt) {
        evt.target.velocity({ opacity: 0 }, { display: "none" });
      }

      // Attach event listeners
      const carouselCells = document.getElementsByClassName("carousel-cell");

      for(let i=0; i<carouselCells.length; i++) {
        carouselCells[i].addEventListener("mouseenter", handleEventListeners);
      } 

      // Navbar menu animation
      const navbar = document.querySelector(".navbar-mask");
      $( ".navbar-mask" ).hover(function() {
        $( ".navbar" ).animate({
            opacity: 1,
            bottom: "-10",
            height: "3em"
          }, 200, function() {
            // Animation complete.
          });
        }
      );

      // We want to pop-up a full screen thing with a totally different interface and menu at the bottom
      // Menu viz interface UI
      const $menuVizInterfaceUI = $("#menu-viz");
      let count = 0;
      const horizontalMenuItemWidth = $(".menu-viz-horizontal-row-container").width();
      const horizontalMenuFlexGap = parseInt($("#menu-viz-horizontal-labels-container").css("gap"));
      //const horizontalMenuItemMaxWidth = parseInt($(".menu-viz-horizontal-row-container").css("width"));
      
      console.log("Flex gap: " + horizontalMenuFlexGap);
      console.log("Item width with width(): " + horizontalMenuItemWidth);
      // console.log("horizontal menu item max width: " + horizontalMenuItemMaxWidth);

      $( ".navbar-mask" ).click(function(event) {
          // Position the horizontal menu's first element at the center of the screen
          $("#menu-viz-horizontal-labels-container").css('transform', 'translateX(' + window.innerWidth/2 - horizontalMenuItemWidth/2 + 'px)');

          $menuVizInterfaceUI.toggleClass( "menu-visualization-interface-bg-show", true );

          ++count;          
        }
      );

      $menuVizInterfaceUI.click(function(event) {
        $menuVizInterfaceUI.removeClass( "menu-visualization-interface-bg-show" );        
      });

      // We want to attach onhover events on the keyboard nav menu at the bottom center to displace the indicator
      // Handler
      let $sel = $(".selection-indicator");
      $sel.css("opacity", 0); // hide it at first, reveal if hover over keyboard keys
      let currentPositionLeft = 0;
      let containerOriginY = -768;
      let currentPositionBottom = containerOriginY;
      let centerOfScreen = window.innerWidth/2; // where the horizontal labels start
      let currentKeyMenuIndex = 0; // ordered

      $(".keyboard-rectangle").each(function( index ) {
        let $rect = $( this );
        $rect.mouseover( () => { 
          currentPositionLeft = $rect[0].getBoundingClientRect().x;
          const retrievedID = $rect[0].getAttribute("id");
          currentKeyMenuIndex = retrievedID.charAt(retrievedID.length - 1);

          // We want to offset the bottom position of the squares in the nice menu
          // using the indexing from the keyboard keys (parseInt on the id to retrieve each key's index)
          let $rotatedBoxContainer = $("#menu-viz-rotated-boxes-container");
          // containerOriginY = window.getComputedStyle($rotatedBoxContainer[0]).getPropertyValue('y');
          let moveTo = currentPositionBottom + currentKeyMenuIndex * 200;
          $("#menu-viz-rotated-boxes-container").css('transform', 'rotate(35deg) translateY(' + moveTo + 'px)');

          // Translate the labels left from right
          let trueCenter = (window.innerWidth/2 - horizontalMenuItemWidth/2);
          let _offsetToNextCenter = horizontalMenuItemWidth * (currentKeyMenuIndex);
          let _gap = horizontalMenuFlexGap * (currentKeyMenuIndex);
          let moveToH = trueCenter - _offsetToNextCenter - _gap;

          //$("#menu-viz-horizontal-labels-container").css('transform', 'translateX(' + moveToH + 'px)');

          $("#menu-viz-horizontal-labels-container").animate({
            opacity: 1,
            bottom: "20vh",
            left: moveToH,
            easing: "easein",
            duration: "slow"
          }, 100, function() {
            // Animation complete.
          });

          // Move and animate the selector
          $sel.animate({
            opacity: 1,
            bottom: 0,
            left: currentPositionLeft,
            easing: "easein",
            duration: "slow"
          }, 30, function() {
            // Animation complete.
          });
          // Teleportation call:          
          // $sel.css("left", currentPositionLeft);
        });
      });   

      // Section sliding?
      		// init
		var controller = new ScrollMagic.Controller();

    // define movement of panels
    var wipeAnimation = new TimelineMax()
      // animate to second panel
      .to("#slideContainer", 0.5, {z: -150})		// move back in 3D space
      .to("#slideContainer", 1,   {x: "-25%"})	// move in to first panel
      .to("#slideContainer", 0.5, {z: 0})				// move back to origin in 3D space
      // animate to third panel
      .to("#slideContainer", 0.5, {z: -150, delay: 1})
      .to("#slideContainer", 1,   {x: "-50%"})
      .to("#slideContainer", 0.5, {z: 0})
      // animate to forth panel
      .to("#slideContainer", 0.5, {z: -150, delay: 1})
      .to("#slideContainer", 1,   {x: "-75%"})
      .to("#slideContainer", 0.5, {z: 0});

    // create scene to pin and link animation
    new ScrollMagic.Scene({
        triggerElement: "#pinContainer",
        triggerHook: "onLeave",
        duration: "500%"
      })
      .setPin("#pinContainer")
      .setTween(wipeAnimation)
      .addIndicators() // add indicators (requires plugin)
      .addTo(controller);
    </script>
  </body>
</html>
